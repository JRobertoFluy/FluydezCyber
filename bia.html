<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIA ‚Äì An√°lise de Impacto | Fluydez Cyber</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* * DESIGN SYSTEM (Fluydez Cyber) - Copiado de servicos.html */
        :root {
            --dark-bg: #121212;
            --card-bg: #1C1C1E;
            --primary-blue: #007BFF;
            --light-blue: #00AFFF;
            --text-light: #F0F0F0;
            --text-secondary: #AAAAAA;
            --highlight-bg: #1A1A1A; 
            --color-error: #e53935; 
            --color-success: #4CAF50;
        }

        /* --- Estilo Base (Copiado de servicos.html) --- */
        body { 
            font-family: 'Poppins', 'Arial', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-light);
            line-height: 1.6;
            min-height: 100vh;
            display: flex; /* Para empurrar o footer para baixo */
            flex-direction: column;
            
            /* Fundo com imagem de seguran√ßa e overlay escuro (index pattern) */
            background-image: linear-gradient(rgba(18, 18, 18, 0.95), rgba(18, 18, 18, 0.95)), 
                              url('sec_index.jpeg'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            flex-grow: 1; 
        }

        /* --- CABE√áALHO (Copiado e adaptado de servicos.html) --- */
        .header {
            background-color: rgba(18, 18, 18, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 2px solid var(--primary-blue);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            text-decoration: none;
            display: flex; 
            align-items: center;
            gap: 8px; 
        }
        .logo-img { height: 45px; width: auto; }
        .logo span { color: var(--primary-blue); }
        .nav-menu ul { list-style: none; display: flex; }
        .nav-menu li { margin-left: 25px; }
        .nav-menu a {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 400;
            transition: color 0.3s ease;
        }
        .nav-menu a:hover,
        .nav-menu a.active { color: var(--primary-blue); }


        /* --- CONTE√öDO PRINCIPAL E FORMUL√ÅRIO --- */
        .main-content-wrapper {
            padding-top: 40px;
            padding-bottom: 40px;
        }
        .main-content {
            background: var(--highlight-bg); 
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--card-bg);
        }
        .page-title {
            color: var(--text-light);
            font-size: 2rem;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary-blue);
            padding-left: 15px;
            font-weight: 700;
        }
        
        /* Estilos de Fieldset e Campos */
        fieldset { 
            margin-bottom: 30px; 
            padding: 20px;
            border: 1px solid var(--card-bg);
            border-radius: 8px;
        }
        legend { 
            font-weight: 600; 
            font-size: 1.4rem;
            padding: 0 10px;
            color: var(--primary-blue);
        }
        
        label { 
            display: block; 
            margin-top: 15px; 
            font-weight: 400; 
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        input, textarea, select, .form-select { 
            width: 100%; 
            padding: 10px; 
            margin-top: 5px;
            background-color: var(--card-bg) !important;
            color: var(--text-light) !important;
            border: 1px solid var(--card-bg);
            border-radius: 4px;
        }
        input:focus, textarea:focus, select:focus, .form-select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
            background-color: var(--highlight-bg) !important;
        }

        /* Bot√µes */
        .btn-group-actions button {
            padding: 10px 18px; 
            margin-right: 10px;
            border-radius: 4px;
            font-weight: 600;
        }
        .btn-primary { background-color: var(--primary-blue) !important; border-color: var(--primary-blue) !important; }
        .btn-primary:hover { background-color: var(--light-blue) !important; border-color: var(--light-blue) !important; }

        /* Estilo do Modal (para combinar com o tema) */
        .modal-content { background-color: var(--card-bg); color: var(--text-light); }
        .modal-header, .modal-footer { border-color: var(--highlight-bg); }
        .modal-title { color: var(--text-light); }


        /* --- RODAP√â (Copiado de servicos.html) --- */
        .footer {
            background-color: var(--dark-bg);
            border-top: 1px solid var(--card-bg);
            padding: 30px 0;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: auto;
        }

    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">
                <img src="imagens/Logo_Fluydez.png" alt="Logo Fluydez Cyber" class="logo-img">
                Fluydez<span>Cyber</span>
            </a>
            <nav class="nav-menu">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="servicos.html">Servi√ßos</a></li>
					<li><a href="ferramentas.html" class="active">Ferramentas</a></li>
                    <li><a href="treinamentos.html">Treinamentos</a></li>
                     <li><a href="sobre.html">Sobre</a></li>
                    <li><a href="contato.html">Contato</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container main-content-wrapper">
        
        <h2 class="page-title">BIA ‚Äì <span class="text-primary-blue">An√°lise de Impacto aos Neg√≥cios</span></h2>

        <div class="main-content">
            
            <div class="d-flex justify-content-end mb-4">
                <div class="btn-group-actions">
                    <button class="btn btn-outline-info" type="button" data-bs-toggle="modal" data-bs-target="#historyModal">üïí Hist√≥rico</button>
                    <button class="btn btn-outline-success" type="button" id="btnExportCSV">‚¨áÔ∏è Baixar CSV</button>
                </div>
            </div>

            <form id="biaForm">
                <input type="hidden" name="id" id="processId">
                
                <div class="row">
                    <div class="col-lg-6">
                        <fieldset>
                            <legend>1. Identifica√ß√£o do Processo e Responsabilidade</legend>

                            <label>ID do Processo/Atividade</label>
                            <input type="text" name="process_id" id="process_id_input" placeholder="Ex: PROC-001">

                            <label>Nome do Processo/Atividade</label>
                            <input type="text" name="process_name" id="process_name_input" placeholder="Ex: Processamento de Vendas Online" required>

                            <label>Propriet√°rio do Processo (PO)</label>
                            <input type="text" name="process_owner" id="process_owner_input" placeholder="Ex: Jo√£o Silva">

                            <label>Data da An√°lise</label>
                            <input type="date" name="analysis_date" id="analysis_date_input">
                            
                            <label>Produtos/Servi√ßos Apoiados</label>
                            <textarea name="supported_services" id="supported_services_input" rows="2" placeholder="Descreva os produtos/servi√ßos que dependem deste processo"></textarea>
                        </fieldset>
                    </div>

                    <div class="col-lg-6">
                        <fieldset>
                            <legend>2.1. Probabilidade (Frequ√™ncia/Exposi√ß√£o ‚Äì 1 a 5)</legend>
                            <label>Selecione o n√≠vel de probabilidade do risco ocorrer:</label>
                            <select name="probabilidade_nivel" id="probabilidade_nivel_input" class="form-select">
                                <option value="1">1 ‚Äì Extremamente Remota</option>
                                <option value="2">2 ‚Äì Baixa (Pode ocorrer em 5+ anos)</option>
                                <option value="3">3 ‚Äì Moderada (Pode ocorrer em 1-5 anos)</option>
                                <option value="4">4 ‚Äì Alta (Pode ocorrer em 6-12 meses)</option>
                                <option value="5">5 ‚Äì Quase Certa (Pode ocorrer em 0-6 meses)</option>
                            </select>
                        </fieldset>

                        <fieldset>
                            <legend>2.2. Impactos (1 a 5)</legend>
                            <p class="text-secondary" style="font-size: 0.9rem;">Selecione o impacto potencial de uma interrup√ß√£o em cada √°rea.</p>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label>Financeiro</label>
                                    <select name="impacto_financeiro" id="impacto_financeiro_input" class="form-select">
                                        <option value="1">1 ‚Äì Insignificante</option>
                                        <option value="2">2 ‚Äì Baixo</option>
                                        <option value="3">3 ‚Äì Moderado</option>
                                        <option value="4">4 ‚Äì Alto</option>
                                        <option value="5">5 ‚Äì Cr√≠tico</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label>Imagem / Reputacional</label>
                                    <select name="impacto_imagem" id="impacto_imagem_input" class="form-select">
                                        <option value="1">1 ‚Äì Nenhum</option>
                                        <option value="2">2 ‚Äì Baixo</option>
                                        <option value="3">3 ‚Äì Moderado</option>
                                        <option value="4">4 ‚Äì Alto</option>
                                        <option value="5">5 ‚Äì Cr√≠tico (Dano Irrevers√≠vel)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label>Operacional</label>
                                    <select name="impacto_operacional" id="impacto_operacional_input" class="form-select">
                                        <option value="1">1 ‚Äì Nenhum</option>
                                        <option value="2">2 ‚Äì Pequena Interrup√ß√£o</option>
                                        <option value="3">3 ‚Äì Perda de Capacidade (Parcial)</option>
                                        <option value="4">4 ‚Äì Interrup√ß√£o Significativa</option>
                                        <option value="5">5 ‚Äì Parada Total e Cr√≠tica</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label>Legal / Regulat√≥rio</label>
                                    <select name="impacto_legal" id="impacto_legal_input" class="form-select">
                                        <option value="1">1 ‚Äì Nenhum</option>
                                        <option value="2">2 ‚Äì Baixo Risco de Multa</option>
                                        <option value="3">3 ‚Äì Alto Risco de Multa</option>
                                        <option value="4">4 ‚Äì Processo Legal ou Auditoria</option>
                                        <option value="5">5 ‚Äì Viola√ß√£o Cr√≠tica e Irrevers√≠vel</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <fieldset>
                            <legend>3. Requisitos de Recupera√ß√£o (RTO e RPO)</legend>
                            <p class="text-secondary" style="font-size: 0.9rem;">Defina os objetivos de tempo para recupera√ß√£o.</p>

                            <label>Per√≠odo M√°ximo Toler√°vel de Interrup√ß√£o (MTPD / MAO)</label>
                            <input type="text" name="mtpd" id="mtpd_input" placeholder="Ex: 4 horas">

                            <label>Objetivo de Tempo de Recupera√ß√£o (RTO)</label>
                            <input type="text" name="rto" id="rto_input" placeholder="Ex: 2 horas">

                            <label>Objetivo de Ponto de Recupera√ß√£o (RPO)</label>
                            <input type="text" name="rpo" id="rpo_input" placeholder="Ex: 15 minutos (perda m√°xima de dados)">

                            <label>Necessidade de Retomada Manual (Procedimento)</label>
                            <textarea name="manual_recovery" id="manual_recovery_input" rows="2" placeholder="Descreva a a√ß√£o manual necess√°ria para iniciar a recupera√ß√£o"></textarea>
                        </fieldset>
                    </div>

                    <div class="col-lg-6">
                        <fieldset>
                            <legend>4. Depend√™ncias e Recursos Cr√≠ticos</legend>

                            <label>Sistemas / Aplica√ß√µes Cr√≠ticos</label>
                            <textarea name="critical_systems" id="critical_systems_input" rows="2" placeholder="Sistemas essenciais para este processo (Ex: ERP, CRM)"></textarea>

                            <label>Fornecedores / Terceiros Cr√≠ticos</label>
                            <textarea name="critical_suppliers" id="critical_suppliers_input" rows="2" placeholder="Terceiros essenciais (Ex: Provedor de Cloud, Link de Dados)"></textarea>

                            <label>Recursos Humanos Cr√≠ticos</label>
                            <textarea name="critical_hr" id="critical_hr_input" rows="2" placeholder="Fun√ß√µes ou pessoas cr√≠ticas para a opera√ß√£o/recupera√ß√£o"></textarea>

                            <label>Requisitos Espec√≠ficos</label>
                            <textarea name="special_requirements" id="special_requirements_input" rows="2" placeholder="Ex: Energia dedicada, refrigera√ß√£o, seguran√ßa f√≠sica"></textarea>
                        </fieldset>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 text-center mt-3">
                        <button class="btn btn-primary" type="submit" id="btnSaveProcess">üíæ Salvar / Atualizar BIA</button>
                        <button class="btn btn-outline-secondary" type="button" id="btnResetForm">‚ûï Limpar Formul√°rio</button>
                        <button class="btn btn-outline-info" type="button" data-bs-toggle="modal" data-bs-target="#recordsModal">Revisar Registros Salvos</button>
                    </div>
                </div>
            </form>

            <div class="modal fade" id="recordsModal" tabindex="-1">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">üìù Registros BIA Salvos</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="recordsTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Processo</th>
                                            <th>PO</th>
                                            <th>Probab.</th>
                                            <th>RTO</th>
                                            <th>RPO</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="historyModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">üïí Hist√≥rico de Altera√ß√µes (LocalStorage)</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div id="historyBody" style="max-height: 400px; overflow-y: auto;">
                                </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Navega√ß√£o R√°pida: 
                <a href="index.html" class="text-primary-blue" style="color: var(--primary-blue);">Home</a> |
                <a href="servicos.html" class="text-primary-blue" style="color: var(--primary-blue);">Servi√ßos</a> |
                <a href="bia.html" class="text-primary-blue" style="color: var(--primary-blue);">BIA</a> |
                <a href="sobre.html" class="text-primary-blue" style="color: var(--primary-blue);">Sobre</a> |
                <a href="contato.html" class="text-primary-blue" style="color: var(--primary-blue);">Contato</a>
            </p>
            <p>&copy; 2025 Fluydez Cyber. Todos os direitos reservados. | An√°lise de Impacto aos Neg√≥cios (BIA).</p>
        </div>
    </footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const STORAGE_KEY = 'fluydezBIARecords';
    const LOG_STORAGE_KEY = 'fluydezBIALogs';
    const form = document.getElementById('biaForm');
    const recordsModal = new bootstrap.Modal(document.getElementById('recordsModal'));
    const historyModal = new bootstrap.Modal(document.getElementById('historyModal'));

    let records = loadRecords();
    let logs = loadLogs();

    // --- Helpers de Storage ---
    function loadRecords() {
        try {
            const json = localStorage.getItem(STORAGE_KEY);
            return json ? JSON.parse(json) : [];
        } catch { return []; }
    }
    function saveRecords() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }
    function loadLogs() {
        try {
            const json = localStorage.getItem(LOG_STORAGE_KEY);
            return json ? JSON.parse(json) : [];
        } catch { return []; }
    }
    function saveLog(action, details) {
        const logEntry = {
            action: action,
            details: details,
            timestamp: new Date().toLocaleString('pt-BR')
        };
        logs.unshift(logEntry);
        localStorage.setItem(LOG_STORAGE_KEY, JSON.stringify(logs));
    }
    function generateNextId() {
        const maxId = records.reduce((max, r) => r.id > max ? r.id : max, 0);
        return maxId + 1;
    }

    // --- L√≥gica do Formul√°rio ---
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const data = gatherFormData();
        const existingId = document.getElementById('processId').value;

        if (existingId) {
            const id = parseInt(existingId);
            const index = records.findIndex(r => r.id === id);
            if (index !== -1) {
                records[index] = { ...data, id };
                saveLog('Atualiza√ß√£o', `Processo ID ${id}: ${data.process_name}`);
                showToast(`Processo #${id} atualizado.`);
            }
        } else {
            const newId = generateNextId();
            records.push({ ...data, id: newId });
            saveLog('Cria√ß√£o', `Novo Processo ID ${newId}: ${data.process_name}`);
            showToast(`Novo Processo #${newId} salvo.`);
        }

        saveRecords();
        resetForm();
        populateRecordsTable();
    });

    document.getElementById('btnResetForm').addEventListener('click', resetForm);
    document.getElementById('btnExportCSV').addEventListener('click', exportCSV);
    
    document.querySelector('[data-bs-target="#recordsModal"]').addEventListener('click', populateRecordsTable);
    document.querySelector('[data-bs-target="#historyModal"]').addEventListener('click', populateHistoryModal);


    function gatherFormData() {
        const formData = {};
        new FormData(form).forEach((value, key) => {
            formData[key] = value;
        });
        return formData;
    }

    function resetForm() {
        form.reset();
        document.getElementById('processId').value = '';
        document.getElementById('btnSaveProcess').textContent = 'üíæ Salvar / Atualizar BIA';
        showToast('Formul√°rio limpo.');
    }

    function loadForEdit(id) {
        recordsModal.hide();
        const record = records.find(r => r.id === id);
        if (!record) return showToast('Registro n√£o encontrado.', true);

        // Preenche campos de texto e textarea
        document.getElementById('processId').value = record.id;
        document.getElementById('process_id_input').value = record.process_id || '';
        document.getElementById('process_name_input').value = record.process_name || '';
        document.getElementById('process_owner_input').value = record.process_owner || '';
        document.getElementById('analysis_date_input').value = record.analysis_date || '';
        document.getElementById('supported_services_input').value = record.supported_services || '';
        document.getElementById('mtpd_input').value = record.mtpd || '';
        document.getElementById('rto_input').value = record.rto || '';
        document.getElementById('rpo_input').value = record.rpo || '';
        document.getElementById('manual_recovery_input').value = record.manual_recovery || '';
        document.getElementById('critical_systems_input').value = record.critical_systems || '';
        document.getElementById('critical_suppliers_input').value = record.critical_suppliers || '';
        document.getElementById('critical_hr_input').value = record.critical_hr || '';
        document.getElementById('special_requirements_input').value = record.special_requirements || '';
        
        // Preenche os novos campos de dropdown de risco
        document.getElementById('probabilidade_nivel_input').value = record.probabilidade_nivel || '1';
        document.getElementById('impacto_financeiro_input').value = record.impacto_financeiro || '1';
        document.getElementById('impacto_imagem_input').value = record.impacto_imagem || '1';
        document.getElementById('impacto_operacional_input').value = record.impacto_operacional || '1';
        document.getElementById('impacto_legal_input').value = record.impacto_legal || '1';


        document.getElementById('btnSaveProcess').textContent = `üíæ Atualizar Processo #${id}`;
        window.scrollTo({ top: 0, behavior: 'smooth' });
        showToast(`Carregando processo #${id} para edi√ß√£o.`);
    }

    function deleteRecord(id) {
        if (!confirm(`Tem certeza que deseja excluir o processo #${id}?`)) return;
        const initialLength = records.length;
        records = records.filter(r => r.id !== id);
        if (records.length < initialLength) {
            saveRecords();
            saveLog('Exclus√£o', `Processo ID ${id} exclu√≠do.`);
            populateRecordsTable();
            showToast(`Processo #${id} exclu√≠do.`);
        }
    }

    function populateRecordsTable() {
        const tbody = document.querySelector('#recordsTable tbody');
        tbody.innerHTML = '';
        if (records.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="text-center text-secondary">Nenhum registro BIA salvo.</td></tr>';
            return;
        }

        records.forEach(r => {
            const tr = document.createElement('tr');
            // Usando Probabilidade no lugar de Criticidade
            tr.innerHTML = `
                <td>${r.id}</td>
                <td>${r.process_name || 'N/A'}</td>
                <td>${r.process_owner || 'N/A'}</td>
                <td>N√≠vel ${r.probabilidade_nivel || '1'}</td> 
                <td>${r.rto || 'N/A'}</td>
                <td>${r.rpo || 'N/A'}</td>
                <td>
                    <button class="btn btn-sm btn-primary action-button" onclick="loadForEdit(${r.id})">Editar</button>
                    <button class="btn btn-sm btn-danger action-button" onclick="deleteRecord(${r.id})">Excluir</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function populateHistoryModal() {
        const historyBody = document.getElementById('historyBody');
        historyBody.innerHTML = '';
        
        if (logs.length === 0) {
            historyBody.innerHTML = '<p class="text-center text-secondary mt-3">Nenhum evento de cria√ß√£o/atualiza√ß√£o/exclus√£o registrado.</p>';
            return;
        }

        const ul = document.createElement('ul');
        ul.className = 'list-group';
        logs.forEach(log => {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.style.backgroundColor = 'var(--dark-bg)';
            li.style.borderColor = 'var(--highlight-bg)';
            li.innerHTML = `
                <div style="color: var(--primary-blue); font-weight: 600;">${log.action}</div>
                <div style="color: var(--text-light);">${log.details}</div>
                <small class="text-secondary">${log.timestamp}</small>
            `;
            ul.appendChild(li);
        });
        historyBody.appendChild(ul);
    }

    function exportCSV() {
        if (records.length === 0) {
            showToast('Nenhum dado para exportar.', true);
            return;
        }
        
        const headers = Object.keys(records[0]);
        const rows = [headers.join(',')];
        
        records.forEach(r => {
            const values = headers.map(h => {
                let value = r[h] !== undefined && r[h] !== null ? String(r[h]).replace(/"/g, '""') : '';
                return `"${value}"`;
            });
            rows.push(values.join(','));
        });

        const csvString = rows.join('\n');
        const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'bia_analise_impacto.csv';
        a.click();
        URL.revokeObjectURL(url);
        showToast('Exporta√ß√£o CSV iniciada.');
    }

    // --- Toast Notification ---
    function showToast(msg, isError = false) {
        const toastEl = document.createElement('div');
        const bgClass = isError ? 'bg-danger' : 'bg-success';
        toastEl.className = `toast align-items-center text-white ${bgClass} border-0 show`;
        toastEl.style.position = 'fixed';
        toastEl.style.right = '20px';
        toastEl.style.bottom = (20 + Math.random() * 50) + 'px';
        toastEl.style.zIndex = 9999;
        toastEl.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">${msg}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" onclick="this.parentElement.parentElement.remove()"></button>
            </div>
        `;
        document.body.appendChild(toastEl);
        setTimeout(() => toastEl.remove(), 3500);
    }

    // Inicializa a data de an√°lise com a data atual ao carregar
    document.getElementById('analysis_date_input').value = new Date().toISOString().split('T')[0];

</script>
</body>
</html>